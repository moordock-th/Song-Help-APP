     <!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordStudio Pro ‚Äì Songwriter Edition</title>
    <style>
        :root {
            --primary: #38bdf8;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
        }

        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        .no-print { display: block; }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        /* App Layout */
        .editor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        @media (max-width: 800px) { .editor-grid { grid-template-columns: 1fr; } }

        /* Inputs */
        .settings-bar { background: var(--card); padding: 20px; border-radius: 12px; display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; }
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.8rem; color: var(--primary); font-weight: bold; }
        input, select, textarea { 
            background: #0f172a; border: 1px solid #334155; color: white; 
            padding: 10px; border-radius: 6px; font-size: 14px; 
        }

        textarea { width: 100%; height: 400px; font-family: 'Fira Code', monospace; line-height: 1.5; }

        /* Preview / Song Rendering */
        .preview-area { background: white; color: #1e293b; padding: 40px; border-radius: 12px; min-height: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .song-title { font-size: 24px; font-weight: bold; margin-bottom: 5px; border-bottom: 2px solid #38bdf8; }
        .song-meta { font-size: 14px; color: #64748b; margin-bottom: 20px; font-style: italic; }

        .line { margin-bottom: 12px; display: flex; flex-wrap: wrap; line-height: 2.8; }
        .word-group { position: relative; margin-right: 6px; }
        .chord-mark { 
            position: absolute; top: -1.4em; left: 0; 
            font-weight: bold; color: #0284c7; font-size: 14px;
        }

        /* Chord Library Below Song */
        .chord-charts { 
            margin-top: 40px; border-top: 1px solid #e2e8f0; padding-top: 20px;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px;
        }
        .chord-box { text-align: center; font-size: 12px; }
        svg { width: 70px; height: 85px; }

        /* Print Logic */
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .preview-area { box-shadow: none; padding: 0; width: 100%; }
            .container { max-width: 100%; padding: 0; }
        }

        button { 
            background: var(--primary); color: #0f172a; border: none; 
            padding: 12px 20px; border-radius: 6px; font-weight: bold; cursor: pointer;
        }
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>

<div class="container">
    <header class="no-print">
        <h1>üé∏ ChordStudio Pro</h1>
    </header>

    <div class="settings-bar no-print">
        <div class="input-group">
            <label>Song Titel</label>
            <input type="text" id="titleInput" placeholder="Titel des Songs" oninput="updatePreview()">
        </div>
        <div class="input-group">
            <label>Tonart</label>
            <input type="text" id="keyInput" placeholder="z.B. C-Dur" oninput="updatePreview()">
        </div>
        <div class="input-group">
            <label>Stimmung</label>
            <select id="tuningInput" onchange="updatePreview()">
                <option value="Standard (EADGBE)">Standard</option>
                <option value="Eb-Tuning">Eb-Tuning</option>
                <option value="Drop D">Drop D</option>
                <option value="Open G">Open G</option>
            </select>
        </div>
        <button onclick="window.print()">üñ®Ô∏è PDF speichern / Drucken</button>
    </div>

    <div class="editor-grid">
        <div class="no-print">
            <label>Text & Akkorde (Format: [Am]Text)</label>
            <textarea id="chordInput" placeholder="Beispiel:&#10;[G]Somewhere [D]over the rainbow&#10;[C]Way up [G]high" oninput="updatePreview()">[G]Somewhere [D]over the rainbow
[C]Way up [G]high</textarea>
            <p style="font-size: 12px; color: #94a3b8; margin-top: 10px;">
                Tipp: Setze Akkorde in eckige Klammern <b>[C]</b> direkt vor das Wort.
            </p>
        </div>

        <div class="preview-area" id="printArea">
            <div id="songHeader">
                <div class="song-title" id="outTitle">Titel des Songs</div>
                <div class="song-meta" id="outMeta">Key: C-Dur | Tuning: Standard</div>
            </div>
            <div id="songContent"></div>
            <div class="chord-charts" id="chordCharts"></div>
        </div>
    </div>
</div>

<script>
    const db = {
        'C': [-1, 3, 2, 0, 1, 0], 'Cm': [-1, 3, 5, 5, 4, 3], 'D': [-1, -1, 0, 2, 3, 2], 'Dm': [-1, -1, 0, 2, 3, 1],
        'E': [0, 2, 2, 1, 0, 0], 'Em': [0, 2, 2, 0, 0, 0], 'F': [1, 3, 3, 2, 1, 1], 'G': [3, 2, 0, 0, 0, 3],
        'A': [-1, 0, 2, 2, 2, 0], 'Am': [-1, 0, 2, 2, 1, 0], 'B': [-1, 2, 4, 4, 4, 2], 'Bb': [-1, 1, 3, 3, 3, 1]
    };

    function createChordSvg(frets) {
        let svg = `<svg viewBox="0 0 100 120">
            <line x1="10" y1="20" x2="90" y2="20" stroke="black" stroke-width="3"/>`;
        for(let i=0; i<6; i++) svg += `<line x1="${10+i*16}" y1="20" x2="${10+i*16}" y2="100" stroke="gray" stroke-width="1"/>`;
        for(let i=0; i<5; i++) svg += `<line x1="10" y1="${20+i*20}" x2="90" y2="${20+i*20}" stroke="gray" stroke-width="1"/>`;
        frets.forEach((f, s) => {
            let x = 10 + s * 16;
            if (f === 0) svg += `<circle cx="${x}" cy="10" r="4" fill="none" stroke="green" stroke-width="1.5"/>`;
            else if (f > 0) svg += `<circle cx="${x}" cy="${20 + f*20 - 10}" r="6" fill="black"/>`;
            else if (f === -1) svg += `<text x="${x-4}" y="12" font-size="12" fill="red">√ó</text>`;
        });
        return svg + `</svg>`;
    }

    function updatePreview() {
        const text = document.getElementById('chordInput').value;
        const outTitle = document.getElementById('outTitle');
        const outMeta = document.getElementById('outMeta');
        const songContent = document.getElementById('songContent');
        const chordCharts = document.getElementById('chordCharts');

        outTitle.innerText = document.getElementById('titleInput').value || 'Unbenannter Song';
        outMeta.innerText = `Key: ${document.getElementById('keyInput').value || '-'} | Tuning: ${document.getElementById('tuningInput').value}`;

        songContent.innerHTML = '';
        chordCharts.innerHTML = '';
        let foundChords = new Set();

        const lines = text.split('\n');
        lines.forEach(line => {
            let lineDiv = document.createElement('div');
            lineDiv.className = 'line';
            
            // Regex erkennt [Akkord] und den folgenden Text
            const regex = /\[([^\]]+)\]([^\[]*)/g;
            let match;
            let hasMatch = false;

            while ((match = regex.exec(line)) !== null) {
                hasMatch = true;
                let chord = match[1];
                let words = match[2];
                foundChords.add(chord);

                lineDiv.innerHTML += `
                    <div class="word-group">
                        <span class="chord-mark">${chord}</span>
                        <span>${words.replace(/ /g, '&nbsp;')}</span>
                    </div>`;
            }

            if (!hasMatch) lineDiv.innerText = line;
            songContent.appendChild(lineDiv);
        });

        foundChords.forEach(c => {
            let cleanC = c.charAt(0).toUpperCase() + c.slice(1);
            if(db[cleanC]) {
                chordCharts.innerHTML += `<div class="chord-box"><strong>${cleanC}</strong><br>${createChordSvg(db[cleanC])}</div>`;
            }
        });
    }

    window.onload = updatePreview;
</script>

</body>
</html>
