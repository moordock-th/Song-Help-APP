<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Akkorde Pro - Kompakt</title>
    <style>
        :root {
            --primary: #667eea;
            --chord-size: 45px;
            --font-size: 16px;
            --line-spacing: 1.2;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0; padding: 0;
            color: #333;
        }

        .app {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            background: #eee;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #ccc;
        }

        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .control-group label { font-size: 11px; font-weight: bold; text-transform: uppercase; }

        .content { padding: 20px; }

        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        .buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; }
        .btn-success { background: #28a745; }
        .btn-primary { background: var(--primary); }
        .btn-secondary { background: #6c757d; }

        /* --- DER KOMPAKTE TEXTBLOCK --- */
        .preview {
            line-height: var(--line-spacing);
            background: white;
        }

        .line {
            display: flex;
            flex-wrap: wrap;
            /* Der Trick: Genug Platz nach oben f√ºr den schwebenden Akkord */
            padding-top: calc(var(--chord-size) * 1.3); 
            margin-bottom: 5px;
        }

        .word-wrapper {
            position: relative;
            display: inline-block;
            margin-right: 0.3em;
        }

        .chord-box {
            position: absolute;
            bottom: 100%; /* Schiebt den Akkord √ºber das Wort */
            left: 0;
            width: var(--chord-size);
            margin-bottom: 2px;
            pointer-events: none;
        }

        .chord-name {
            display: block;
            font-weight: bold;
            font-size: calc(var(--chord-size) * 0.35);
            color: var(--primary);
            text-align: left;
            margin-bottom: 1px;
        }

        .chord-svg {
            width: var(--chord-size);
            height: auto;
            display: block;
        }

        .word-text {
            font-size: var(--font-size);
            white-space: nowrap;
        }

        /* Legende am Ende */
        .chord-legend {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        .legend-grid { display: flex; flex-wrap: wrap; gap: 15px; }

        @media print {
            .header, .controls, textarea, .buttons { display: none !important; }
            .app { box-shadow: none; width: 100%; }
            .line { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="app">
    <div class="header"><h1>üé∏ Songblock Pro</h1></div>

    <div class="controls">
        <div class="control-group">
            <label>Akkorde (Gr√∂√üe)</label>
            <input type="range" id="chordSize" min="25" max="70" value="40" oninput="updateLayout()">
        </div>
        <div class="control-group">
            <label>Text (Gr√∂√üe)</label>
            <input type="range" id="textSize" min="10" max="30" value="16" oninput="updateLayout()">
        </div>
    </div>

    <div class="content">
        <textarea id="input" placeholder="Tippe Text und Akkorde..." oninput="renderSong()">
G        D        Em       C
Dies ist ein kompakter Textblock.
G        D        C5
Akkorde schweben direkt √ºber den Worten.
        </textarea>

        <div class="buttons">
            <button class="btn-primary" onclick="window.print()">üñ®Ô∏è Drucken</button>
            <button class="btn-secondary" onclick="document.getElementById('input').value=''; renderSong();">üóëÔ∏è L√∂schen</button>
        </div>

        <div id="output" class="preview"></div>
    </div>
</div>

<script>
    const chordsDb = {
        "C": "x32010", "D": "xx0232", "E": "022100", "F": "133211", "G": "320003", "A": "x02220", "B": "x24442",
        "Cm": "x35543", "Dm": "xx0231", "Em": "022000", "Am": "x02210", "Bm": "x24432",
        "C7": "x32310", "D7": "xx0212", "G7": "320001", "C5": "x355xx", "G5": "355xxx"
        // ... (weitere Akkorde k√∂nnen hier wie gewohnt erg√§nzt werden)
    };

    function updateLayout() {
        const cSize = document.getElementById('chordSize').value;
        const tSize = document.getElementById('textSize').value;
        document.documentElement.style.setProperty('--chord-size', cSize + 'px');
        document.documentElement.style.setProperty('--font-size', tSize + 'px');
    }

    function createSvg(pattern) {
        const frets = pattern.split('');
        let dots = '';
        frets.forEach((fret, i) => {
            if (fret !== 'x' && fret !== '0') {
                dots += `<circle cx="${5+(i*7)}" cy="${10+(parseInt(fret, 16)*8)}" r="2.5" fill="black" />`;
            }
        });
        return `<svg class="chord-svg" viewBox="0 0 45 60"><rect x="5" y="10" width="35" height="40" fill="white" stroke="#333" stroke-width="0.5"/>${[10, 18, 26, 34, 42, 50].map(y => `<line x1="5" y1="${y}" x2="40" y2="${y}" stroke="#333" stroke-width="0.5"/>`).join('')}${[5, 12, 19, 26, 33, 40].map(x => `<line x1="${x}" y1="10" x2="${x}" y2="50" stroke="#333" stroke-width="0.5"/>`).join('')}${dots}</svg>`;
    }

    function renderSong() {
        const input = document.getElementById('input').value;
        const output = document.getElementById('output');
        const lines = input.split('\n');
        let html = '';
        let used = new Set();

        lines.forEach(line => {
            if (!line.trim()) { html += '<div style="height:1em"></div>'; return; }
            html += '<div class="line">';
            
            // Wir splitten nach Worten, behalten aber die Leerzeichen f√ºr die Positionierung
            const segments = line.split(/(\s+)/);
            
            segments.forEach(seg => {
                let clean = seg.trim();
                let chordMatch = Object.keys(chordsDb).find(k => k.toLowerCase() === clean.toLowerCase());

                if (chordMatch) {
                    html += `<div class="word-wrapper">
                                <div class="chord-box">
                                    <span class="chord-name">${chordMatch}</span>
                                    ${createSvg(chordsDb[chordMatch])}
                                </div>
                                <span class="word-text">&nbsp;&nbsp;</span>
                             </div>`;
                    used.add(chordMatch);
                } else {
                    html += `<div class="word-wrapper"><span class="word-text">${seg.replace(/ /g, '&nbsp;')}</span></div>`;
                }
            });
            html += '</div>';
        });

        if (used.size > 0) {
            html += `<div class="chord-legend"><h3>Griffe in diesem Song</h3><div class="legend-grid">`;
            Array.from(used).sort().forEach(c => {
                html += `<div style="text-align:center;"><span class="chord-name">${c}</span>${createSvg(chordsDb[c])}</div>`;
            });
            html += `</div></div>`;
        }
        output.innerHTML = html;
    }

    updateLayout();
    renderSong();
</script>
</body>
</html>
