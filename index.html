<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Song Akkorde">
    <meta name="theme-color" content="#667eea">
    
    <title>Song Lyrics & Akkorde Pro</title>
    
    <style>
        :root {
            --primary: #667eea;
            --success: #28a745;
            --dark: #333;
            --chord-size: 40px;
            --font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f0f2f5;
            margin: 0; padding: 0;
        }

        .app {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
        }

        .tabs { display: flex; background: #eee; position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; }
        .tab.active { border-bottom: 3px solid var(--primary); color: var(--primary); background: white; }

        .content { padding: 15px; flex: 1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Steuerung f√ºr Schriftgr√∂√üen */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .control-group label { font-size: 12px; font-weight: bold; color: #666; }

        .song-meta-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .song-meta-input input, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
        }

        textarea { height: 120px; font-family: monospace; margin-bottom: 15px; }

        .buttons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        button { padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; }
        .btn-success { background: var(--success); }
        .btn-primary { background: var(--primary); }
        .btn-secondary { background: #6c757d; }

        /* --- DAS NEUE AKKORD-LAYOUT --- */
        .preview {
            background: white;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }

        .line {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px; /* Abstand zwischen Textzeilen */
            line-height: 1;
            padding-top: calc(var(--chord-size) + 15px); /* Platz f√ºr Akkorde schaffen */
        }

        .word-wrapper {
            position: relative;
            margin-right: 6px;
            display: inline-block;
        }

        .chord-box {
            position: absolute;
            bottom: 100%; /* Positioniert den Akkord direkt √úBER dem Wort */
            left: 50%;
            transform: translateX(-50%);
            width: var(--chord-size);
            text-align: center;
            margin-bottom: 2px;
        }

        .chord-name {
            font-weight: bold;
            font-size: calc(var(--chord-size) * 0.3);
            color: var(--primary);
            display: block;
            margin-bottom: 1px;
        }

        .chord-svg {
            width: var(--chord-size);
            height: calc(var(--chord-size) * 1.2);
        }

        .word-text {
            font-size: var(--font-size);
            white-space: nowrap;
        }

        /* Legende am Ende */
        .chord-legend { margin-top: 40px; border-top: 2px solid #eee; padding-top: 20px; }
        .chord-legend h3 { margin-bottom: 15px; }
        .legend-grid { display: flex; flex-wrap: wrap; gap: 15px; }

        /* DRUCK-EINSTELLUNGEN */
        @media print {
            @page { margin: 1cm; }
            .header, .tabs, .controls, .song-meta-input, textarea, .buttons, .status { display: none !important; }
            .app { box-shadow: none; width: 100%; max-width: 100%; }
            .preview { border: none; }
            .line { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="app">
    <div class="header"><h1>üé∏ Song Akkorde Pro</h1></div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('editor')">Editor</div>
        <div class="tab" onclick="switchTab('library')">Bibliothek</div>
    </div>

    <div class="content">
        <div id="editor" class="tab-content active">
            
            <div class="controls">
                <div class="control-group">
                    <label>Akkord-Gr√∂√üe</label>
                    <input type="range" id="chordSizeRange" min="30" max="80" value="45" oninput="updateScales()">
                </div>
                <div class="control-group">
                    <label>Text-Gr√∂√üe</label>
                    <input type="range" id="fontSizeRange" min="12" max="30" value="18" oninput="updateScales()">
                </div>
            </div>

            <div class="song-meta-input">
                <input type="text" id="songKey" placeholder="Song Titel / Tonart">
                <input type="text" id="songTuning" placeholder="Tuning">
            </div>

            <textarea id="input" oninput="showChords()">G D Em C
Dies ist ein Beispiel-Text
G D C5
Akkorde schweben nun direkt dar√ºber</textarea>

            <div class="buttons">
                <button class="btn-success" onclick="showChords()">üéµ Aktualisieren</button>
                <button class="btn-primary" onclick="window.print()">üñ®Ô∏è Drucken</button>
                <button class="btn-secondary" onclick="clearAll()">üóëÔ∏è L√∂schen</button>
            </div>

            <div id="status" style="text-align:center; font-size:11px; color:#999; margin-bottom:5px;"></div>
            <div class="preview" id="output"></div>
        </div>

        <div id="library" class="tab-content">
            <div id="chordLibraryContent" class="legend-grid"></div>
        </div>
    </div>
</div>

<script>
    const chords = {
        "C": "x32010", "C#": "x46664", "Db": "x46664", "D": "xx0232", "Eb": "x68886", "E": "022100", "F": "133211", "F#": "244322", "Gb": "244322", "G": "320003", "Ab": "466544", "A": "x02220", "Bb": "x13331", "B": "x24442",
        "Cm": "x35543", "Dm": "xx0231", "Em": "022000", "Fm": "133111", "Gm": "355333", "Am": "x02210", "Bm": "x24432",
        "C7": "x32310", "D7": "xx0212", "E7": "020100", "G7": "320001", "A7": "x02020",
        "Csus2": "x30033", "Dsus2": "xx0230", "Asus2": "x02200",
        "Csus4": "x33011", "Dsus4": "xx0233", "Asus4": "x02230",
        "Cadd9": "x32030", "Gadd9": "320005",
        "C5": "x355xx", "D5": "x577xx", "E5": "022xxx", "G5": "355xxx", "A5": "x022xx"
    };

    function updateScales() {
        const cSize = document.getElementById('chordSizeRange').value;
        const fSize = document.getElementById('fontSizeRange').value;
        document.documentElement.style.setProperty('--chord-size', cSize + 'px');
        document.documentElement.style.setProperty('--font-size', fSize + 'px');
    }

    function makeChordSVG(pattern) {
        const frets = pattern.split('');
        let dots = '';
        frets.forEach((fret, i) => {
            if (fret !== 'x' && fret !== '0') {
                dots += `<circle cx="${5+(i*7)}" cy="${10+(parseInt(fret, 16)*8)}" r="2.5" fill="black" />`;
            }
        });
        return `
            <svg class="chord-svg" viewBox="0 0 45 60" xmlns="http://www.w3.org/2000/svg">
                <rect x="5" y="10" width="35" height="40" fill="white" stroke="#333" stroke-width="0.5"/>
                ${[10, 18, 26, 34, 42, 50].map(y => `<line x1="5" y1="${y}" x2="40" y2="${y}" stroke="#333" stroke-width="0.5"/>`).join('')}
                ${[5, 12, 19, 26, 33, 40].map(x => `<line x1="${x}" y1="10" x2="${x}" y2="50" stroke="#333" stroke-width="0.5"/>`).join('')}
                ${dots}
            </svg>`;
    }

    function showChords() {
        const input = document.getElementById('input').value;
        const output = document.getElementById('output');
        const key = document.getElementById('songKey').value;
        const tuning = document.getElementById('songTuning').value;
        
        let html = '';
        if(key || tuning) {
            html += `<div style="border-bottom:2px solid #333; margin-bottom:20px;">`;
            if(key) html += `<h2 style="margin:0;">${key}</h2>`;
            if(tuning) html += `<p style="margin:5px 0;">Tuning: ${tuning}</p>`;
            html += `</div>`;
        }

        let usedChords = new Set();
        const lines = input.split('\n');

        lines.forEach(line => {
            html += '<div class="line">';
            const words = line.split(/(\s+)/);
            
            words.forEach(word => {
                let clean = word.trim();
                let normalized = Object.keys(chords).find(k => k.toLowerCase() === clean.toLowerCase());

                if (normalized) {
                    html += `
                        <div class="word-wrapper">
                            <div class="chord-box">
                                <span class="chord-name">${normalized}</span>
                                ${makeChordSVG(chords[normalized])}
                            </div>
                            <span class="word-text">&nbsp;</span> 
                        </div>`;
                    usedChords.add(normalized);
                } else if (word === " ") {
                    html += '<span>&nbsp;</span>';
                } else {
                    html += `<div class="word-wrapper"><span class="word-text">${word}</span></div>`;
                }
            });
            html += '</div>';
        });

        if (usedChords.size > 0) {
            html += `<div class="chord-legend"><h3>Verwendete Griffe</h3><div class="legend-grid">`;
            Array.from(usedChords).sort().forEach(c => {
                html += `<div style="text-align:center;">
                            <span style="font-weight:bold; display:block;">${c}</span>
                            ${makeChordSVG(chords[c])}
                         </div>`;
            });
            html += `</div></div>`;
        }
        output.innerHTML = html;
        document.getElementById('status').innerText = usedChords.size + " Akkorde erkannt";
    }

    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if (event) event.currentTarget.classList.add('active');
        if (tabId === 'library') {
            const lib = document.getElementById('chordLibraryContent');
            lib.innerHTML = Object.keys(chords).sort().map(c => `
                <div style="text-align:center; padding:10px; border:1px solid #eee;">
                    <span style="font-weight:bold; display:block;">${c}</span>
                    ${makeChordSVG(chords[c])}
                </div>`).join('');
        }
    }

    function clearAll() {
        document.getElementById('input').value = '';
        showChords();
    }

    updateScales();
    window.onload = showChords;
</script>

</body>
</html>
